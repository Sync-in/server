<div class="modal-header">
  <h4 class="modal-title">
    <fa-icon [icon]="icons.faRotate"></fa-icon>
    <span class="ms-2">{{ syncPath.settings.name }}</span>
  </h4>
  <button (click)="layout.closeDialog()" aria-label="Close" class="btn-close btn-close-white" type="button"></button>
</div>
<div class="modal-body">
  <tabset [justified]="true" type="pills">
    <tab customClass="tab-dialog">
      <ng-template tabHeading>
        <span class="app-tab-heading">
          <span class="app-tab-label">{{ 'Settings' | translate:locale.language }}</span>
        </span>
      </ng-template>
      <div class="app-tab-content">
        <app-sync-path-settings [showPaths]="true" [syncPath]="syncPath" direction="start" size="large"></app-sync-path-settings>
      </div>
    </tab>
    <tab customClass="tab-dialog">
      <ng-template tabHeading>
        <span class="app-tab-heading">
          <span class="app-tab-label">{{ 'Filters' | translate:locale.language }}</span>
        </span>
      </ng-template>
      <div class="app-tab-content sync-filters-tab">
        <div class="card dialog-tab-card sync-filters-card">
          <div class="card-body p-3">
            <div class="sync-filters-field mb-2">
              <label class="form-label mb-1" for="sync-filter-type" l10nTranslate>Filter type</label>
              <select id="sync-filter-type" [(ngModel)]="currentFilterType" class="form-select form-select-sm">
                @if (store.isElectronApp()) {
                  <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.FILE">Select a file</option>
                  <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.FOLDER">Select a folder</option>
                }
                <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.START">The files starting</option>
                <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.IN">The files containing</option>
                <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.END">The files ending</option>
                <option l10nTranslate [value]="SYNC_PATH_FILTER_TYPE.EXPERT">Expert (Regexp)</option>
              </select>
            </div>

            <div class="sync-filters-field">
              <label class="form-label mb-1" for="sync-filter-value" l10nTranslate>Filter value</label>
              <div class="sync-filters-entry-row">
                <input
                  id="sync-filter-value"
                  [(ngModel)]="currentFilter"
                  [disabled]="currentFilterType === SYNC_PATH_FILTER_TYPE.FILE || currentFilterType === SYNC_PATH_FILTER_TYPE.FOLDER"
                  [placeholder]="filterTypePlaceholder[currentFilterType] | translate:locale.language"
                  class="form-control form-select-sm"
                  type="text">
                <div class="sync-filters-actions">
                  @if (currentFilterType === SYNC_PATH_FILTER_TYPE.FILE) {
                    <button (click)="onSelect()" class="btn btn-xs btn-default" l10nTranslate type="button">Browse</button>
                  }
                  @if (currentFilterType === SYNC_PATH_FILTER_TYPE.FOLDER) {
                    <button (click)="onSelect(ELECTRON_DIALOG.DIRECTORY)" class="btn btn-xs btn-default" l10nTranslate type="button">Browse</button>
                  }
                  <button (click)="addFilter()" [disabled]="!currentFilter" class="btn btn-xs btn-success" l10nTranslate type="button">Add</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card dialog-tab-card sync-filters-card">
          <div class="card-body p-2">
            @if (syncPath.settings.filters.length) {
              @for (f of syncPath.settings.filters; track $index; let i = $index) {
                <div class="sync-filter-item">
                  <input [ngModel]="f"
                         (ngModelChange)="syncPath.settings.filters[i] = $event"
                         class="form-control form-control-sm"
                         type="text">
                  <button (click)="onRemoveFilter(i)" class="btn btn-xs btn-danger" data-dismiss="modal" type="button">
                    <fa-icon [icon]="icons.faTimes"></fa-icon>
                  </button>
                </div>
              }
            } @else {
              <div class="sync-filter-empty text-muted" l10nTranslate>No filter configured</div>
            }
          </div>
        </div>
      </div>
    </tab>
  </tabset>
</div>
<div class="modal-footer">
  <button (click)="confirmDeletion = true"
          [disabled]="confirmDeletion"
          class="btn btn-sm btn-danger me-2" data-dismiss="modal" type="button" l10nTranslate>
    Remove
  </button>
  @if (store.isElectronApp()) {
    <button (click)="onFlush()" class="btn btn-sm btn-warning" data-dismiss="modal" type="button" l10nTranslate>Reset</button>
  }
  <button (click)="onCancel()" class="btn btn-sm btn-secondary ms-auto" data-dismiss="modal" type="button" l10nTranslate>Cancel</button>
  <button (click)="onSubmit()"
          [disabled]="!syncPath.settings.name"
          class="btn btn-sm {{confirmDeletion ? 'btn-danger' : 'btn-primary'}}" type="submit" l10nTranslate>
    {{ confirmDeletion ? 'Confirm deletion' : 'Confirm' }}
  </button>
</div>
